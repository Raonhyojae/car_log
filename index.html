<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>차량운행기록부</title>
  <link rel="stylesheet" href="./css/styles.css" />
<script type="module" src="./js/basicInfo.js"></script>
<script type="module" src="./js/tripLog.js"></script>
<script type="module" src="./js/excelExport.js"></script>
</head>
<body>
  <div class="container" role="main" aria-label="차량운행기록부">
    <h1>차량운행기록부</h1>

    <div class="info-box" role="region" aria-label="사업 정보">
      <div><strong>사업연도</strong> : <span id="business-year">로딩중...</span></div>
      <div><strong>사업자 등록번호</strong> : 214-86-53129</div>
    </div>

    <div class="table-wrapper" aria-label="기본 정보">
      <table aria-describedby="basic-info-caption" id="basic-info-table">
        <caption id="basic-info-caption">기본 정보 (차량 선택: 차종 클릭)</caption>
        <thead>
          <tr>
            <th scope="col">차종</th>
            <th scope="col">자동차등록번호</th>
            <th scope="col">자택</th>
            <th scope="col">근무지</th>
            <th scope="col">출퇴근거리 (km)</th>
          </tr>
        </thead>
        <tbody id="basic-info-tbody">
          <!-- JS에서 렌더링 -->
        </tbody>
      </table>
      <div id="add-row-container">
        <button id="add-row-btn" aria-label="행 추가">+</button>
        <button id="export-excel-btn" aria-label="엑셀 저장">엑셀 저장</button>
      </div>
    </div>

    <div id="notice" role="alert" aria-live="polite" style="display:none;">
      차량을 선택해주세요. 기본정보에서 차종을 클릭하면 해당 차량의 운행 기록이 표시됩니다.<br>
      부서와 직책은 선택할 수 있게 되어있고, 출발누적거리와 주행거리, 업무용주행거리누계는<br>
      수정이 불가합니다.<br>
    </div>

    <div class="table-wrapper" aria-label="운행 기록" id="trip-log-wrapper" style="display:none;">
      <table aria-describedby="trip-log-caption">
        <caption id="trip-log-caption">운행 기록</caption>
        <thead>
          <tr>
            <th scope="col">일련번호</th>
            <th scope="col">부서</th>
            <th scope="col">직책</th>
            <th scope="col">성명</th>
            <th scope="col" class="use-date-col">사용<br>목적</th>
            <th scope="col" class="use-date-col">사용<br>일자</th>
            <th scope="col" class="departure-col">출발지</th>
            <th scope="col" class="use-date-col">출발<br>누적<br>거리<br>(km)</th>
            <th scope="col">도착지</th>
            <th scope="col" class="use-date-col">도착<br>누적<br>거리<br>(km)</th>
            <th scope="col" class="use-date-col">주행<br>거리<br>(km)</th>
            <th scope="col" class="use-date-col">업무용<br>주행<br>거리<br>누계<br>(km)</th>
            <th scope="col">주유<br>금액<br>(원)</th>
            <th scope="col">주유<br>용량<br>(L)</th>
          </tr>
        </thead>
        <tbody id="trip-log-tbody">
          <!-- JS에서 렌더링 -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- SheetJS CDN -->
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- 모듈 스크립트 -->
  <script type="module">
    import { initBasicInfo, onVehicleSelected, getBasicInfoData } from './js/basicInfo.js';
    import { renderTripLog } from './js/tripLog.js';
    import { exportToExcel } from './js/excelExport.js';

    document.addEventListener('DOMContentLoaded', () => {
      // 사업연도 표시
      const today = new Date();
      document.getElementById('business-year').textContent = today.getFullYear() + '년';

      // 기본정보 초기화
      initBasicInfo();

      // 차량 선택 이벤트 처리
      document.getElementById('basic-info-tbody').addEventListener('click', e => {
        if (e.target.classList.contains('selectable-vehicle')) {
          const vehicleName = e.target.textContent.trim();
          onVehicleSelected(vehicleName);
          renderTripLog(vehicleName);
        }
      });

      // 행 추가 버튼
      document.getElementById('add-row-btn').addEventListener('click', () => {
        initBasicInfo('addRow');
      });

      // 엑셀 저장 버튼
      document.getElementById('export-excel-btn').addEventListener('click', () => {
        const data = getBasicInfoData();
        exportToExcel(data);
      });
    });
  </script>
</body>
</html>